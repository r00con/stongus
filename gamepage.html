<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Stongus Game</title>

<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

<style>
body {
  margin: 0;
  font-family: 'Press Start 2P', cursive;
  background: #0b0b0b;
  color: white;
}

#topbar {
  display: flex;
  justify-content: space-between;
  padding: 12px;
  background: #111;
  border-bottom: 3px solid #222;
}

#topbar button {
  font-family: 'Press Start 2P', cursive;
  padding: 6px 10px;
  background: #2ecc71;
  border: none;
  cursor: pointer;
}

#main {
  padding: 20px;
}

#toggle button {
  font-family: 'Press Start 2P', cursive;
  margin-right: 10px;
  padding: 6px 10px;
}

#stocks {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(220px,1fr));
  gap: 15px;
}

.stock {
  border: 3px solid #333;
  padding: 15px;
  background: #151515;
  cursor: pointer;
}

.stock:hover {
  border-color: #2ecc71;
}
</style>
</head>

<body>

<div id="topbar">
  <div id="user"></div>
  <div>
    $<span id="money">0</span>
    <button onclick="location.href='friends.html'">Friends</button>
  </div>
</div>

<div id="main">
  <div id="toggle">
    <button onclick="mode='owned';render()">Owned</button>
    <button onclick="mode='unowned';render()">Unowned</button>
  </div>

  <div id="stocks"></div>
</div>

<script>
const user = localStorage.getItem("stongus_user");
if (!user) location.href = "landing.html";

document.getElementById("user").innerText = user;

let player = {};
let stocks = {};
let mode = "owned";

async function load() {
  player = await fetch(`/player?user=${user}`).then(r => r.json());
  stocks = await fetch(`/stocks`).then(r => r.json());
  money.innerText = player.money;
  render();
}

function render() {
  stocksDiv.innerHTML = "";

  for (let s in stocks) {
    const owned = player.stocks.includes(s);
    if (mode === "owned" && !owned) continue;
    if (mode === "unowned" && owned) continue;

    const d = document.createElement("div");
    d.className = "stock";
    d.innerHTML = `${s}<br>$${stocks[s]}`;
    d.onclick = () => openStock(s);
    stocksDiv.appendChild(d);
  }
}

function openStock(name) {
  localStorage.setItem("stongus_selected_stock", name);
  window.location.href = "stockspage.html";
}

const stocksDiv = document.getElementById("stocks");
load();
setInterval(load, 650);
</script>

</body>
</html>
